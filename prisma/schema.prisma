generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           Int      @id @default(autoincrement())
  email        String   @unique
  password     String
  name         String
  role         Role
  adminId      Int?     // For teachers, parents, students: points to their admin
  admin        User?    @relation("AdminUsers", fields: [adminId], references: [id])
  users        User[]   @relation("AdminUsers") // For admin: all sub-users
  appTitle     String?  // Only for admin
  appLogoUrl   String?  // Only for admin
  subjects     Subject[] @relation("StudentSubjects")
  teaching     Subject[] @relation("TeacherSubjects")
  parentOf     User[]   @relation("ParentStudents")
  parents      User[]   @relation("ParentStudents")
  progressAsStudent Progress[] @relation("ProgressStudent")
  progressAsTeacher Progress[] @relation("ProgressTeacher")
  createdAt    DateTime @default(now())
}

model Subject {
  id         Int      @id @default(autoincrement())
  name       String
  adminId    Int
  admin      User     @relation(fields: [adminId], references: [id])
  teacherId  Int
  teacher    User     @relation("TeacherSubjects", fields: [teacherId], references: [id])
  students   User[]   @relation("StudentSubjects")
  progress   Progress[]
  createdAt  DateTime @default(now())
}

model Progress {
  id         Int      @id @default(autoincrement())
  studentId  Int
  subjectId  Int
  teacherId  Int
  text       String?
  percentage Int?
  createdAt  DateTime @default(now())
  student    User     @relation("ProgressStudent", fields: [studentId], references: [id])
  subject    Subject  @relation(fields: [subjectId], references: [id])
  teacher    User     @relation("ProgressTeacher", fields: [teacherId], references: [id])
}

enum Role {
  DEVELOPER
  ADMIN
  TEACHER
  PARENT
  STUDENT
}
  text       String?
  percentage Int?
  createdAt  DateTime @default(now())
  student    User     @relation("ProgressStudent", fields: [studentId], references: [id])
  subject    Subject  @relation(fields: [subjectId], references: [id])
  teacher    User     @relation("ProgressTeacher", fields: [teacherId], references: [id])
}

enum Role {
  DEVELOPER
  ADMIN
  TEACHER
  PARENT
  STUDENT
}
